## 协方差

二维联合分布中除含有各分量的边际分布外，还含有两个分量间相互关联的信息。描述这种相互关联程度的一个特征数就是协方差，它的定义如下：

+ 定义 设![](http://latex.codecogs.com/gif.latex?\\left( {X,Y} \\right))是一个二维随机变量，若![](http://latex.codecogs.com/gif.latex?E\\left[ {\\left( {X - E\\left( X \\right)} \\right)\\left( {Y - E\\left( Y \\right)} \\right)} \\right]) \\right])存在，则称此数学期望为![](http://latex.codecogs.com/gif.latex?x)和![](http://latex.codecogs.com/gif.latex?y)的协方差，或称为![](http://latex.codecogs.com/gif.latex?x)和![](http://latex.codecogs.com/gif.latex?y)的**相关（中心）矩**，并记为
![](http://latex.codecogs.com/gif.latex?Cov\\left( {X,Y} \\right) = E\\left[ {\\left( {X - E\\left( X \\right)} \\right)\\left( {Y - E\\left( Y \\right)} \\right)} \\right])
特别有![](http://latex.codecogs.com/gif.latex?\\left( {X,Y} \\right))











本文讲述一下蒙特卡洛模拟方法与定积分计算，首先从一个题目开始：设![](http://latex.codecogs.com/gif.latex?0\\leq f(x) \\leq 1)  用蒙特卡洛模拟法求定积分![](http://latex.codecogs.com/gif.latex?J=\\int_{0}^{1}f(x)dx)  的值。

### 随机投点法
设(X,Y)服从正方形 {0≤x≤1,0≤y≤1}上的均匀分布，则可知X,Y分别服从[0,1]上的均匀分布，且X,Y相互独立。记事件A={Y≤f(X)}，则A的概率为![](http://latex.codecogs.com/gif.latex?P(A)=P(Y\\leq f(X))=\\int_{0}^{1}\\int_{0}^{f(x)}dydx=\\int_{0}^{1}f(x)dx=J)
即定积分J的值 就是事件A出现的频率。同时，由伯努利大数定律，我们可以用重复试验中A出现的频率作为p的估计值。即将(X,Y)看成是正方形{0≤x≤1,0≤y≤1}内的随机投点，用随机点落在区域y≤f(x)中的频率作为定积分的近似值。这种方法就叫随机投点法，具体做法如下：  
![](http://cos.name/wp-content/uploads/2010/03/m5.png)  

+ 首先产生服从 [0,1]上的均匀分布的2n个随机数（ n为随机投点个数，可以取很大，如 ![](http://latex.codecogs.com/gif.latex?n=10^4) 并将其配对。  
+ 对这n对数据 ![](http://latex.codecogs.com/gif.latex?(x_i,y_i),i=1,2,…,n) ，记录满足不等式![](http://latex.codecogs.com/gif.latex?y_i\\leq f(x_i))的个数，这就是事件 A发生的频数![](http://latex.codecogs.com/gif.latex?\\mu_n)，由此可得事件A发生的频率![](http://latex.codecogs.com/gif.latex?\\frac{\\mu_n}{n})，则![](http://latex.codecogs.com/gif.latex?J\\approx \\frac{\\mu_n} {n})。
+ 举一实例，譬如要计算![](http://latex.codecogs.com/gif.latex?\\int_{0}^{1}e^{-x^2/2}/\\sqrt{2\\pi}dx)，模拟次数![](http://latex.codecogs.com/gif.latex?n=10^4) 时，R代码如下：

```r
n=10^4;
x=runif(n);
y=runif(n);
f=function(x){
 exp(-x^2/2)/sqrt(2*pi)
}
mu_n=sum(y<f(x));
J=mu_n/n;
J
 ```
 
模拟次数 ![](http://latex.codecogs.com/gif.latex?n=10^5) 时，令![](http://latex.codecogs.com/gif.latex?n=10^5),其余不变。  
定积![](http://latex.codecogs.com/gif.latex?\\int_{0}^{1}e^{-x^2/2}/\\sqrt{2\\pi}dx)的精确值和模拟值如下：  

精确值 | ![](http://latex.codecogs.com/gif.latex?n=10^3) | ![](http://latex.codecogs.com/gif.latex?n=10^4)  | ![](http://latex.codecogs.com/gif.latex?n=10^5) | ![](http://latex.codecogs.com/gif.latex?n=10^6) | ![](http://latex.codecogs.com/gif.latex?n=10^7)
--- | --- | ---  | --- | --- | --- | ---
0.3413447 | 0.342 | 0.344  | 	0.34187 | 0.341539 | 0.341302

> 注：精确值用integrate(f,0,1)求得

扩展

如果你很细心，你会发现这个方法目前只适用于积分区间[0,1] ，且积分函数 f(x) 在区间[0,1]上的取值也位于 [0,1] 内的情况。那么，对于一般区间 [a,b] 上的定积分![](http://latex.codecogs.com/gif.latex?J’=\\int_{a}^{b}g(x)dx)呢？一个很明显的思路，如果我们可以将 J′ 与J 建立代数关系就可以了。
首先，做线性变换，令 y=(x−a)/(b−a) ，此时，x=(b−a)y+a，![](http://latex.codecogs.com/gif.latex?J’=(b-a)\\int_{0}^{1}g[(b-a)y+a]dy) , 进一步如果在区间[a,b]上有c≤g(x)≤d ，令 ![](http://latex.codecogs.com/gif.latex?f(y)=\\frac{1}{d-c}{g(x)-c}=\\frac{1}{d-c}{g[a+(b-a)y]-c}) ，则 ![](http://latex.codecogs.com/gif.latex?0\\leq f(y) \\leq 1) 此时，可以得到 ![](http://latex.codecogs.com/gif.latex?J’=\\int_{a}^{b}g(x)dx=S_0J+c(b-a)) 。 其中，![](http://latex.codecogs.com/gif.latex?S_0=(b-a)(d-c)) ， ![](http://latex.codecogs.com/gif.latex?J=\\int_{0}^{1}f(y)dy) 。  这说明，用随机投点法计算定积分方法具有普遍意义。举一个实例，求定积分 ![](http://latex.codecogs.com/gif.latex?J’=\\int_{2}^{5}e^{-x^2/2}/\\sqrt{2\\pi}dx)  
显然a=2,b=5，![](http://latex.codecogs.com/gif.latex?c=min\\{g(x)|2\\leq x \\leq 5\},d=max\\{g(x)|2\\leq x \\leq 5\\})  ，由于 ![](http://latex.codecogs.com/gif.latex?g(x)=e^{-x^2/2}/\\sqrt{2\\pi})  在 [2,5]上时单调减函数，所以![](http://latex.codecogs.com/gif.latex?c=g(5),d=g(2))，![](http://latex.codecogs.com/gif.latex?S_0=(b-a)(d-c))。R中代码为
```r
a=2;
b=5;
g=function(x){
 exp(-x^2/2)/sqrt(2*pi);
}
f=function(y){
 (g(a+(b-a)*y)-c)/(d-c);
}
c=g(5);d=g(2);s_0=(b-a)*(d-c);
n=10^4;
x=runif(n);y=runif(n);
mu_n=sum(y<=f(x));
J=mu_n/n;
J_0=s_0*J+c*(b-a);
```

定积分![](http://latex.codecogs.com/gif.latex?J’=\\int_{2}^{5}e^{-x^2/2}/\\sqrt{2\\pi}dx)

精确值 | ![](http://latex.codecogs.com/gif.latex?n=10^3) | ![](http://latex.codecogs.com/gif.latex?n=10^4)  | ![](http://latex.codecogs.com/gif.latex?n=10^5) | ![](http://latex.codecogs.com/gif.latex?n=10^6) | ![](http://latex.codecogs.com/gif.latex?n=10^7)
--- | --- | ---  | --- | --- | --- | ---
0.02274985 | 0.02332792 | 0.02311736  | 0.02262659 | 0.02284152 | 0.02278524
> 注：精确值用integrate(g,2,5)求得

### 平均值法
蒙特卡洛模拟法计算定积分时还有另一种方法，叫平均值法。这个原理也很简单：设随机变量 X 服从[0,1]上的均匀分布，则Y=f(X)的数学期望为  
![](http://latex.codecogs.com/gif.latex?E(f(X))=\\int_{0}^{1}f(x)dx=J)  
所以估计J的值就是估计f(X)的数学期望值。由辛钦大数定律，可以用f(X)的观察值的均值取估计f(X)的数学期望。具体做法：  
先用计算机产生n个服从[0,1]上均匀分布的随机数：![](http://latex.codecogs.com/gif.latex?x_i,i=1,2,…,n)。
对每一个![](http://latex.codecogs.com/gif.latex?x_i) ，计算![](http://latex.codecogs.com/gif.latex?f(x_i))。
计算![](http://latex.codecogs.com/gif.latex?J\approx \\frac{1}{n}\\sum_{i=1}^{n}f(x_i))  
譬如，计算  ![](http://latex.codecogs.com/gif.latex?J=\\int_{0}^{1}e^{-x^2/2}/\\sqrt{2\\pi}dx)  R中的代码为
```r
n=10^4;
x=runif(n);
f=function(x){
 exp(-x^2/2)/sqrt(2*pi)
}
J=mean(f(x));
```
其精确值和模拟值如下：  

精确值 | ![](http://latex.codecogs.com/gif.latex?n=10^3) | ![](http://latex.codecogs.com/gif.latex?n=10^4)  | ![](http://latex.codecogs.com/gif.latex?n=10^5) | ![](http://latex.codecogs.com/gif.latex?n=10^6) | ![](http://latex.codecogs.com/gif.latex?n=10^7)
--- | --- | ---  | --- | --- | --- | ---
0.3413447 | 0.3405831 | 0.3410739  | 0.3414443 | 0.3414066 | 0.3413366

